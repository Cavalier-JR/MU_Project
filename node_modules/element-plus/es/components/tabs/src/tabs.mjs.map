{"version":3,"file":"tabs.mjs","sources":["../../../../../../packages/components/tabs/src/tabs.tsx"],"sourcesContent":["import { defineComponent, provide, reactive, ref, renderSlot, watch } from 'vue'\nimport {\n  buildProps,\n  definePropType,\n  isNumber,\n  isString,\n} from '@element-plus/utils'\nimport { EVENT_CODE, UPDATE_MODEL_EVENT } from '@element-plus/constants'\nimport ElIcon from '@element-plus/components/icon'\nimport { Plus } from '@element-plus/icons-vue'\nimport { tabsRootContextKey } from '@element-plus/tokens'\nimport { useNamespace } from '@element-plus/hooks'\nimport TabNav from './tab-nav'\nimport type { TabNavInstance } from './tab-nav'\nimport type { TabsPaneContext } from '@element-plus/tokens'\n\nimport type { ExtractPropTypes } from 'vue'\nimport type { Awaitable } from '@element-plus/utils'\n\nexport type TabPanelName = string | number\n\nexport const tabsProps = buildProps({\n  type: {\n    type: String,\n    values: ['card', 'border-card', ''],\n    default: '',\n  },\n  activeName: {\n    type: [String, Number],\n    default: '',\n  },\n  closable: Boolean,\n  addable: Boolean,\n  modelValue: {\n    type: [String, Number],\n    default: '',\n  },\n  editable: Boolean,\n  tabPosition: {\n    type: String,\n    values: ['top', 'right', 'bottom', 'left'],\n    default: 'top',\n  },\n  beforeLeave: {\n    type: definePropType<\n      (\n        newName: TabPanelName,\n        oldName: TabPanelName\n      ) => Awaitable<void | boolean>\n    >(Function),\n    default: () => true,\n  },\n  stretch: Boolean,\n} as const)\nexport type TabsProps = ExtractPropTypes<typeof tabsProps>\n\nconst isPanelName = (value: unknown): value is string | number =>\n  isString(value) || isNumber(value)\n\nexport const tabsEmits = {\n  [UPDATE_MODEL_EVENT]: (name: TabPanelName) => isPanelName(name),\n  'tab-click': (pane: TabsPaneContext, ev: Event) => ev instanceof Event,\n  'tab-change': (name: TabPanelName) => isPanelName(name),\n  edit: (paneName: TabPanelName | undefined, action: 'remove' | 'add') =>\n    ['remove', 'add'].includes(action),\n  'tab-remove': (name: TabPanelName) => isPanelName(name),\n  'tab-add': () => true,\n}\nexport type TabsEmits = typeof tabsEmits\n\nexport default defineComponent({\n  name: 'ElTabs',\n\n  props: tabsProps,\n  emits: tabsEmits,\n\n  setup(props, { emit, slots, expose }) {\n    const ns = useNamespace('tabs')\n\n    const nav$ = ref<TabNavInstance>()\n    const panes = reactive<Record<number, TabsPaneContext>>({})\n    const currentName = ref(props.modelValue || props.activeName || '0')\n\n    const changeCurrentName = (value: TabPanelName) => {\n      currentName.value = value\n      emit(UPDATE_MODEL_EVENT, value)\n      emit('tab-change', value)\n    }\n\n    const setCurrentName = async (value: TabPanelName) => {\n      // should do nothing.\n      if (currentName.value === value) return\n\n      try {\n        const canLeave = await props.beforeLeave?.(value, currentName.value)\n        if (canLeave !== false) {\n          changeCurrentName(value)\n\n          // call exposed function, Vue doesn't support expose in typescript yet.\n          // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n          // @ts-expect-error\n          nav$.value?.removeFocus?.()\n        }\n      } catch {}\n    }\n\n    const handleTabClick = (\n      tab: TabsPaneContext,\n      tabName: TabPanelName,\n      event: Event\n    ) => {\n      if (tab.props.disabled) return\n      setCurrentName(tabName)\n      emit('tab-click', tab, event)\n    }\n\n    const handleTabRemove = (pane: TabsPaneContext, ev: Event) => {\n      if (pane.props.disabled) return\n      ev.stopPropagation()\n      emit('edit', pane.props.name, 'remove')\n      emit('tab-remove', pane.props.name)\n    }\n\n    const handleTabAdd = () => {\n      emit('edit', undefined, 'add')\n      emit('tab-add')\n    }\n\n    watch(\n      () => props.activeName,\n      (modelValue) => setCurrentName(modelValue)\n    )\n\n    watch(\n      () => props.modelValue,\n      (modelValue) => setCurrentName(modelValue)\n    )\n\n    watch(currentName, async () => {\n      // call exposed function, Vue doesn't support expose in typescript yet.\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-expect-error\n      nav$.value?.scrollToActiveTab()\n    })\n\n    {\n      const registerPane = (pane: TabsPaneContext) => (panes[pane.uid] = pane)\n      const unregisterPane = (uid: number) => delete panes[uid]\n\n      provide(tabsRootContextKey, {\n        props,\n        currentName,\n        registerPane,\n        unregisterPane,\n      })\n    }\n\n    expose({\n      currentName,\n    })\n\n    return () => {\n      const newButton =\n        props.editable || props.addable ? (\n          <span\n            class={ns.e('new-tab')}\n            tabindex=\"0\"\n            onClick={handleTabAdd}\n            onKeydown={(ev: KeyboardEvent) => {\n              if (ev.code === EVENT_CODE.enter) handleTabAdd()\n            }}\n          >\n            <ElIcon class={ns.is('icon-plus')}>\n              <Plus />\n            </ElIcon>\n          </span>\n        ) : null\n\n      const header = (\n        <div class={[ns.e('header'), ns.is(props.tabPosition)]}>\n          {newButton}\n          <TabNav\n            ref={nav$}\n            currentName={currentName.value}\n            editable={props.editable}\n            type={props.type}\n            panes={Object.values(panes)}\n            stretch={props.stretch}\n            onTabClick={handleTabClick}\n            onTabRemove={handleTabRemove}\n          />\n        </div>\n      )\n\n      const panels = (\n        <div class={ns.e('content')}>{renderSlot(slots, 'default')}</div>\n      )\n\n      return (\n        <div\n          class={[\n            ns.b(),\n            ns.m(props.tabPosition),\n            {\n              [ns.m('card')]: props.type === 'card',\n              [ns.m('border-card')]: props.type === 'border-card',\n            },\n          ]}\n        >\n          {...props.tabPosition !== 'bottom'\n            ? [header, panels]\n            : [panels, header]}\n        </div>\n      )\n    }\n  },\n})\n"],"names":["tabsProps","buildProps","type","String","values","default","activeName","Number","closable","Boolean","addable","modelValue","editable","tabPosition","beforeLeave","definePropType","Function","stretch","tabsEmits","name","ev","edit","paneName","action","props","emits","setup","emit","slots","expose","ns","nav$","reactive","currentName","changeCurrentName","value","canLeave","removeFocus","handleTabClick","tab","setCurrentName","tabName","handleTabRemove","stopPropagation","pane","handleTabAdd","watch","registerPane","unregisterPane","provide","tabsRootContextKey","_createVNode","newButton","EVENT_CODE","is"],"mappings":"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"}